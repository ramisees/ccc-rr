generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Event {
  id                   Int           @id @default(autoincrement())
  name                 String
  sportType            SportType
  eventDate            DateTime
  registrationDeadline DateTime
  startTime            String        // e.g. "9:00 AM"
  courtCount           Int           @default(2)
  maxPlayers           Int           @default(16)
  status               EventStatus   @default(REGISTRATION_OPEN)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  registrations        Registration[]
  matches              Match[]
}

model Player {
  id               Int            @id @default(autoincrement())
  name             String
  email            String?        @unique
  phone            String?
  gender           Gender?
  sport            String?        // "PICKLEBALL", "TENNIS", or "BOTH"
  skillLevel       SkillLevel?
  rating           Float?         // DUPR-style rating, scale 2.0 â€“ 8.0
  createdAt        DateTime       @default(now())
  registrations    Registration[]
  matchesTeam1P1   Match[]        @relation("Team1Player1")
  matchesTeam1P2   Match[]        @relation("Team1Player2")
  matchesTeam2P1   Match[]        @relation("Team2Player1")
  matchesTeam2P2   Match[]        @relation("Team2Player2")
}

model Registration {
  id           Int                @id @default(autoincrement())
  eventId      Int
  playerId     Int
  registeredAt DateTime           @default(now())
  status       RegistrationStatus @default(CONFIRMED)
  event        Event              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  player       Player             @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([eventId, playerId])
}

model Match {
  id             Int         @id @default(autoincrement())
  eventId        Int
  roundNumber    Int
  courtNumber    Int
  matchType      MatchType
  team1Player1Id Int
  team1Player2Id Int?        // nullable for singles
  team2Player1Id Int
  team2Player2Id Int?        // nullable for singles
  team1Score     Int?
  team2Score     Int?
  status         MatchStatus @default(SCHEDULED)
  event          Event       @relation(fields: [eventId], references: [id], onDelete: Cascade)
  team1Player1   Player      @relation("Team1Player1", fields: [team1Player1Id], references: [id])
  team1Player2   Player?     @relation("Team1Player2", fields: [team1Player2Id], references: [id])
  team2Player1   Player      @relation("Team2Player1", fields: [team2Player1Id], references: [id])
  team2Player2   Player?     @relation("Team2Player2", fields: [team2Player2Id], references: [id])
}

enum SportType {
  PICKLEBALL
  TENNIS
}

enum Gender {
  MALE
  FEMALE
}

enum EventStatus {
  REGISTRATION_OPEN
  REGISTRATION_CLOSED
  SCHEDULE_GENERATED
  COMPLETED
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum RegistrationStatus {
  CONFIRMED
  WAITLISTED
  CANCELLED
}

enum MatchType {
  DOUBLES
  SINGLES
}

enum MatchStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
}
